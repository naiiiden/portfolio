const today = new Date()
const birthday = new Date(2000, 6, 5) // months are 0-based
const age = today.getFullYear() - birthday.getFullYear() - (today.getMonth() < birthday.getMonth() || (today.getMonth() === birthday.getMonth() && today.getDate() < birthday.getDate()))

document.querySelector('.years').textContent = age

let cursor = document.querySelector('.cursor')

document.addEventListener('mousemove', (e) => {
    cursor.style.left = (e.clientX - 7.5) + 'px'
    cursor.style.top = (e.clientY - 2.5) + 'px' 
})

document.querySelectorAll('a[href]').forEach(link => {
    link.addEventListener('mouseenter', () => {
        cursor.classList.remove('cursor')
    })

    link.addEventListener('mouseleave', () => {
        cursor.classList.add('cursor')
    })
})

const text = document.querySelector('.text-reveal')
const img = document.querySelector('img')

function svgStrokeColor() {
    const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches
    img.setAttribute('src', text.classList.contains('anim')
        ? isDark
            ? './images/close-dark.svg'
            : './images/close-light.svg'
        : isDark
            ? './images/open-dark.svg'
            : './images/open-light.svg'
    )
}

svgStrokeColor()

document.querySelector('button').addEventListener('click', () => {
    text.classList.toggle('anim')
    svgStrokeColor()
    img.setAttribute('aria-label', text.classList.contains('anim') ? 'Hide text' : 'Reveal text')
})

window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', svgStrokeColor)

const canvas = document.querySelector('canvas')
const ctx = canvas.getContext('2d')

canvas.width = window.innerWidth
canvas.height = window.innerHeight

let isDrawing = false

canvas.addEventListener('mousedown', startDrawing)
canvas.addEventListener('mousemove', draw)
canvas.addEventListener('mouseup', stopDrawing)
document.addEventListener('mouseleave', stopDrawing)

function startDrawing(e) {
  isDrawing = true
  ctx.beginPath()
  ctx.moveTo(e.offsetX, e.offsetY)
}

function draw(e) {
  if (!isDrawing) return
  ctx.lineTo(e.offsetX, e.offsetY)
  ctx.stroke()
  ctx.lineWidth = .5
  ctx.strokeStyle = getStrokeStyle() // Get the stroke style based on color scheme
}

function stopDrawing() {
  isDrawing = false
}

function getStrokeStyle() {
  const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  return isDarkMode ? '#fff' : '#000'
}

window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
  updateStrokeStyle()
})

// Update the stroke style of existing drawings - thanks ChatGPT
function updateStrokeStyle() {
  const drawings = ctx.getImageData(0, 0, canvas.width, canvas.height)
  const strokeStyle = getStrokeStyle()

  for (let i = 0; i < drawings.data.length; i += 4) {
    // Update the stroke style of each pixel in the drawings
    if (drawings.data[i + 3] > 0) {
      drawings.data[i] = strokeStyle.r
      drawings.data[i + 1] = strokeStyle.g
      drawings.data[i + 2] = strokeStyle.b
    }
  }

  ctx.putImageData(drawings, 0, 0)
}

updateStrokeStyle()
